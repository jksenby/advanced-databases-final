<mat-form-field class="search-bar">
  <mat-label>Search Products</mat-label>
  <input
    matInput
    [formControl]="searchControl"
    (ngModelChange)="getProducts()"
    placeholder="e.g. Laptop"
  />
  <mat-icon matSuffix>search</mat-icon>
</mat-form-field>

<div *ngIf="products.length; else noProducts" class="products">
  <mat-card *ngFor="let product of products" (click)="onView(product._id)">
    <mat-card-header>
      <mat-card-title>{{ product?.name }}</mat-card-title>
      <mat-card-subtitle>{{ product?.category }}</mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
      <p>{{ product?.description }}</p>
    </mat-card-content>
    <mat-card-actions>
      <button mat-raised-button color="warn" (click)="onLike(product._id)">
        <mat-icon>favorite</mat-icon>LIKE
      </button>
      <button mat-raised-button (click)="onPurchase(product._id)">
        <mat-icon>add_shopping_cart</mat-icon> BUY {{product?.price}}₸
      </button>
    </mat-card-actions>
  </mat-card>
</div>
<ng-template #noProducts>
  <p>No Products found</p>
</ng-template>
<form
  *ngIf="isAdmin"
  #adminForm
  class="admin-form"
  [formGroup]="productForm"
  (ngSubmit)="onSubmit()"
>
  <div class="form-group">
    <label for="name">Name</label>
    <input
      type="text"
      formControlName="name"
      class="form-control"
      [ngClass]="{ 'is-invalid': f.name.touched && f.name.errors }"
    />
    <div *ngIf="f.name.touched && f.name.errors" class="invalid-feedback">
      <div *ngIf="f.name.errors.required">Name is required</div>
    </div>
  </div>
  <div class="form-group">
    <label for="description">Description</label>
    <input
      type="text"
      formControlName="description"
      class="form-control"
      [ngClass]="{ 'is-invalid': f.description.touched && f.description.errors }"
    />
    <div
      *ngIf="f.description.touched && f.description.errors"
      class="invalid-feedback"
    >
      <div *ngIf="f.description.errors.required">Description is required</div>
    </div>
  </div>
  <div class="form-group">
    <label>Category</label>
    <mat-select formControlName="category">
      <mat-option *ngFor="let category of categories" [value]="category.value">
        {{ category.label }}
      </mat-option>
    </mat-select>
    <div
      *ngIf="f.category.touched && f.category.errors"
      class="invalid-feedback"
    >
      <div *ngIf="f.category.errors.required">Category is required</div>
    </div>
  </div>
  <div class="form-group">
    <label for="price">Price</label>
    <input
      type="number"
      formControlName="price"
      class="form-control"
      [ngClass]="{ 'is-invalid': f.price.touched && f.price.errors }"
    />
    <div *ngIf="f.price.touched && f.price.errors" class="invalid-feedback">
      <div *ngIf="f.price.errors.required">Price is required</div>
    </div>
  </div>
  <div class="form-group">
    <button class="btn btn-primary" type="submit">Add Product</button>
  </div>
</form>

<h1>Recommendations</h1>
<div *ngIf="recommendations.length; else noRecommendations" class="products">
  <mat-card
    *ngFor="let recommendation of recommendations"
    (click)="onView(recommendation._id)"
  >
    <mat-card-header>
      <mat-card-title>{{ recommendation?.name }}</mat-card-title>
      <mat-card-subtitle>{{ recommendation?.category }}</mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
      <p>{{ recommendation?.description }}</p>
    </mat-card-content>
    <mat-card-actions>
      <button
        mat-raised-button
        color="warn"
        (click)="onLike(recommendation._id)"
      >
        <mat-icon>favorite</mat-icon>LIKE
      </button>
      <button mat-raised-button (click)="onPurchase(recommendation._id)">
        <mat-icon>add_shopping_cart</mat-icon> BUY {{recommendation?.price}}₸
      </button>
    </mat-card-actions>
  </mat-card>
</div>
<ng-template #noRecommendations>
  <p>No Products found</p>
</ng-template>
